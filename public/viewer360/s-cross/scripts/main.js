!function(){var configView,configCore,selectedGradeItem,selectedGradeRelation,gradeList,configIntView,fpView,selectedClsName="selected",selectNoticeClsName="selectNotice",NOT_SELECTED_ID_STR="_I",isSD=RegExp("iphone|ipod|ipad|android|BlackBerry|Windows Phone","i").test(navigator.userAgent);function initFpView(){var features,displayTargetSize;"EXTERIOR"===$(".modeBtn.selected").attr("id")&&(features=configCore.feature_list.EXT,displayTargetSize=configView.getDisplayTargetSize()),features=features||{},fpView=new ConfigFeatureView({features:features,displayTargetId:"#func-point",angle:configView.getCurrentAngle(),step:configView.getAngleStep(),numAngleStep:configView.getNumAngleStep(),templateId:"#TMPL_SP_DESCRIPTION",parentViewSize:displayTargetSize,baseSize:configCore.feature_list.stage})}function gradeListLoadHandler(){$(configCore).unbind("loadComplete"),$(configCore).unbind("loadFailed"),gradeList=configCore.grade_list,(configView=new ConfigView({numAngles:36,numAngleStep:gradeList.angleStep,materialDirPath:gradeList.materialDirPath,displayTarget:"#exteriorStage",loadingIndicator:"#loadingIndicator"})).init(),configView.createSelection("#GRADE_LIST div.slideAreaWrap",gradeList,"#TMPL_ITEM"),loadGradeSetting($("#GRADE_LIST .GRD.selected").attr("id"));for(var step=configView.getNumAngleStep(),i=0;i<step;i++){$("<li>"+i+"</li>").appendTo("#indicator ul")}!function(){var $gradeBtn=$("#GRADE_LIST dd");$gradeBtn.on("click",function(event){event.stopPropagation(),event.returnValue=!1,$gradeBtn.removeClass(selectedClsName),$(this).addClass(selectedClsName),$("#EXT_BACKGROUND div.slideAreaWrap").empty(),$("#EXT_BODY_COLOR div.slideAreaWrap").empty(),$("#EXT_WHEEL div.slideAreaWrap").empty(),$("#EXT_OPTION_ACCESSORY div.slideAreaWrap").empty(),$("#INT_BASE div.slideAreaWrap").empty(),loadGradeSetting($("#GRADE_LIST .GRD.selected").attr("id"))})}(),$("#modeSelect").on("click",".modeBtn",function(){var modeId=$(this).attr("id");$("#modeSelect .modeBtn").removeClass(selectedClsName),$(this).addClass(selectedClsName),$("#selectMenu ul.menuTab li").removeClass("tabOn"),$("#selectMenu .selectMenuWrapper>div").hide(),$("#intfp-descriptions").hide(),"EXTERIOR"===modeId?(initFpView(),configIntView&&configIntView.hide(),configView.showStage(),$("#gradeName").show(),$(".menuTab .extTab").show(),$(".menuTab .intTab").hide(),$(".menuTab li.menuTab-GRD").addClass("tabOn"),$("#GRADE_LIST").show(),$("#indicator").show(),$("#featuresSwitch").show(),$("#featuresSwitch .fpSwitchBtn").hasClass("on")&&$("#func-point").show(),clearInterval(void 0)):"INTERIOR"===modeId&&(configView.hideStage(),configIntView.show(),$("#gradeName").hide(),$(".menuTab .extTab").hide(),$(".menuTab .intTab").show(),$(".menuTab li.menuTab-INT_COL").addClass("tabOn"),$("#INT_BASE").show(),$("#indicator").hide(),$("#featuresSwitch").hide(),$("#func-point").hide(),fpView.hideAllDescriptions()),refreshView(getSelectedItems())}),$(".selectMenuWrapper").on("click",".subMenuBtn",function(event){event.stopPropagation(),event.returnValue=!1,$(this).siblings(".subMenu").toggle()}),$(".selectMenuWrapper").on("click","dd.radioType:not(.noConfig)",function(){configView.cancelLoad();var $subMenu=$(".subMenu",this);$subMenu.is(":visible")&&$subMenu.hide();var itemId=$(this).attr("id"),checkGroup=itemId.split("_")[0];refreshView(getSelectedItems($("#"+checkGroup+" .selected").attr("id"),itemId),this)}),$(".selectMenuWrapper").on("click","div.radioType:not(.noConfig)",function(event){event.stopPropagation(),event.returnValue=!1,configView.cancelLoad();var itemId=$(this).attr("data-subitemid"),checkGroup=itemId.split("_")[0];refreshView(getSelectedItems($("#"+checkGroup+" .selected").attr("id"),itemId),this)}),$(".selectMenuWrapper").on("click","dd.checkType:not(.noConfig)",function(){configView.cancelLoad();var $subMenu=$(".subMenu",this);$subMenu.is(":visible")&&$subMenu.hide();var lastItemId=$(this).attr("id");toggleCheckTypeBtnId(this);var itemId=$(this).attr("id"),selectedItems=getSelectedItems(lastItemId,itemId);refreshView(selectedItems,this)}),$(".selectMenuWrapper").on("click","div.checkType:not(.noConfig)",function(event){event.stopPropagation(),event.returnValue=!1,configView.cancelLoad();var lastItemId=$(this).attr("data-subitemid");toggleCheckTypeBtnId(this),refreshView(getSelectedItems(lastItemId,$(this).attr("data-subitemid")),this)}),$(".selectMenuWrapper").on("click","dd.mixType:not(.noConfig)",function(event){configView.cancelLoad();var $subMenu=$(".subMenu",this);0==$(event.target).parents("dd.selected").length?$subMenu.show():$subMenu.hide();var itemId=$(this).attr("id"),checkGroup=itemId.split("_")[0],lastItemId=$("#"+checkGroup+" .selected").attr("id");lastItemId&&lastItemId!=itemId?toggleCheckTypeBtnId($("#"+lastItemId)):lastItemId=$(this).attr("id"),toggleCheckTypeBtnId(this),refreshView(getSelectedItems(lastItemId,itemId=$(this).attr("id")),this)}),$(".selectMenuWrapper").on("click","div.mixType:not(.noConfig)",function(event){event.stopPropagation(),event.returnValue=!1,configView.cancelLoad();var itemId=$(this).attr("data-subitemid"),checkGroup=itemId.split("_")[0],lastItemId=$("#"+checkGroup+" .selected").attr("id");lastItemId&&lastItemId!=itemId?toggleCheckTypeBtnId($("#"+lastItemId)):lastItemId=$(this).attr("data-subitemid"),toggleCheckTypeBtnId(this),refreshView(getSelectedItems(lastItemId,itemId=$(this).attr("data-subitemid")),this)}),$(".selectMenuWrapper").on("click","dd.fpType:not(.noConfig)",function(){var _id=$(this).attr("id").split("_"),groupId=_id[0],seq=_id[1],label=$("p.itemDescription",this).text();$("#intfp-descriptions div.fp-thumb img").attr("src","../assets/materials/INTFP/"+groupId+"_"+seq+".jpg"),$("#intfp-descriptions p.fp-label").text(label),$("#intfp-descriptions").show()}),function(){var angles=configView.getNumAngleStep(),$indicators=$("#indicator ul li");$indicators.eq(angles/2).addClass("on"),$(configView).on("singleAngleLoad",function(e){var angle=e.angle;angles<=(angle+=angles/2)&&(angle-=angles),$indicators.eq(angle).addClass("loaded")}),$(configView).on("angleChange",function(e){var angle=e.angle;fpView.hideAllDescriptions(),fpView.changeAngle(angle),angles<=(angle+=angles/2)&&(angle-=angles),$indicators.removeClass("on"),$indicators.eq(angle).addClass("on")})}(),setSlideArea("#GRADE_LIST"),$("#func-point").on("click","#fp-descriptions .fp-closeBtn",function(){fpView.hideAllDescriptions()}),$("#intfunc-point").on("click","#intfp-descriptions .fp-closeBtn",function(){$("#intfp-descriptions").hide()}),$("#featuresSwitch .fpSwitchBtn").on("click",function(){$(this).hasClass("on")?($(this).removeClass("on"),$("#func-point").hide(),fpView.hideAllDescriptions()):($(this).addClass("on"),$("#func-point").show())}),$("#selectMenu .menuTab-SMR").on("click",function(){$("#SUMMARY .summaryBlockLeft").empty(),$("#SUMMARY .summaryBlockRight").empty(),addSummaryItem("#SUMMARY .summaryBlockLeft","GRADE","#GRADE_LIST",!1),addSummaryItem("#SUMMARY .summaryBlockLeft","BODY COLOUR","#EXT_BODY_COLOR",!1),addSummaryItem("#SUMMARY .summaryBlockLeft","INTERIOR COLOUR","#INT_BASE",!1),addSummaryItem("#SUMMARY .summaryBlockRight","WHEEL","#EXT_WHEEL",!1),addSummaryItem("#SUMMARY .summaryBlockRight","OPTIONS&ACCESSORIES","#EXT_OPTION_ACCESSORY",!0)}),$(".selectMenuWrapper").on("click","dd.noConfig",function(){$(this).find(".noSimulationTooltip").stop(!0,!1).show(10).animate({opacity:1},3e3).hide(10)}),$(document).on("mousedown",function(event){0==$(event.target).parents(".subMenu").length&&$(".subMenu").hide()})}function loadGradeSetting(grade){if(grade){var gradeData=jsonPath(gradeList,"$[..items[?(@.item_id=='"+grade+"')]")[0];$(configCore).bind("loadComplete",gradeSettingLoadHandler),$(configCore).bind("loadFailed",function(){}),configCore.loadSetting(gradeData)}}var gradeSettingLoadHandler=function(){$(configCore).unbind("loadComplete"),$(configCore).unbind("loadFailed"),$("#EXT_BACKGROUND div.slideAreaWrap").empty(),$("#EXT_BODY_COLOR div.slideAreaWrap").empty(),$("#EXT_WHEEL div.slideAreaWrap").empty(),$("#EXT_OPTION_ACCESSORY div.slideAreaWrap").empty(),$("#INT_BASE div.slideAreaWrap").empty(),selectedGradeItem=configCore.item_list,selectedGradeRelation=configCore.materials_list,configCore.combination_list;var bgJson=jsonPath(selectedGradeItem,"$[.[?(@.category_id=='BACKGROUND')]");bgJson&&configView.createSelection("#EXT_BACKGROUND div.slideAreaWrap",bgJson[0],"#TMPL_ITEM");var bcJson=jsonPath(selectedGradeItem,"$[.[?(@.category_id=='BODYCOLOR')]");if(bcJson){configView.createSelection("#EXT_BODY_COLOR div.slideAreaWrap",bcJson[0],"#TMPL_ITEM");var left=0;$("#EXT_BODY_COLOR div.slideAreaWrap .BC").each(function(){2<$(this).attr("id").split("_").length&&($(this).css({position:"absolute",top:"70px",left:left+"px"}),left+=72)})}var whJson=jsonPath(selectedGradeItem,"$[.[?(@.category_id=='WHEELS')]");whJson&&configView.createSelection("#EXT_WHEEL div.slideAreaWrap",whJson[0],"#TMPL_ITEM");var opJson=jsonPath(selectedGradeItem,"$[.[?(@.category_id=='EXT_OPTION')]");opJson&&configView.createSelection("#EXT_OPTION_ACCESSORY div.slideAreaWrap",opJson[0],"#TMPL_ITEM");var intJson=jsonPath(selectedGradeItem,"$[.[?(@.category_id=='INT_BASE')]");intJson&&configView.createSelection("#INT_BASE div.slideAreaWrap",intJson[0],"#TMPL_ITEM");var intOpJson=jsonPath(selectedGradeItem,"$[.[?(@.category_id=='INT_OPTION')]");if(intOpJson){$("#TMPL_ITEM_INTFP_LIST").tmpl().appendTo("#INT_BASE div.slideAreaWrap"),configView.createSelection("#INTFP_list",intOpJson[0],"#TMPL_ITEM_INTFP");var intFpALength=$("#INTFP-A dd.fpType").length,intFpBLength=$("#INTFP-B dd.fpType").length;0===intFpALength&&$("#INTFP-A").hide(),0===intFpBLength&&$("#INTFP-B").hide(),0===intFpALength&&0===intFpBLength&&$("#INTFP_list").hide()}initFpView(),configIntView||(configIntView=$("#interiorStage"),isSD?setupInteriorView():$("#INT_BOX_WRAP1").remove()),$("#loadingIndicator").stop(!0).show(10).delay(2e3).hide(10);var selectedMode=$("#modeSelect .selected");selectedMode&&$("#"+selectedMode[0].id.toLowerCase()+"Items").show(),refreshView(getSelectedItems()),setSlideArea("#EXT_BODY_COLOR",!0),setSlideArea("#EXT_WHEEL"),setSlideArea("#EXT_OPTION_ACCESSORY")};function getSelectedItems(lastItemId,itemId){var selected_items=[],grade=$("#GRADE_LIST dd.GRD.selected").attr("id"),background=$("#EXT_BACKGROUND dd.BG.selected").attr("id"),bodyColor=$("#EXT_BODY_COLOR dd.BC.selected").attr("id"),wheel=$("#EXT_WHEEL dd.WH.selected").attr("id"),ext_option=[],interior=$("#INT_BASE dd.INTBASE.selected").attr("id"),targetDOM=$("#EXT_OPTION_ACCESSORY dd.radioType.selected");return $.each(targetDOM,function(){var checkRegExp=new RegExp("\\b"+this.id+"\\b"),searchStr=ext_option.join(",");checkRegExp.test(searchStr)||ext_option.push(this.id)}),targetDOM=$("#EXT_OPTION_ACCESSORY .checkType,#EXT_OPTION_ACCESSORY .mixType"),$.each(targetDOM,function(){var _id=$(this).attr("data-subitemid");_id=_id||this.id;var checkRegExp=new RegExp("\\b"+_id+"\\b"),searchStr=ext_option.join(",");checkRegExp.test(searchStr)||ext_option.push(_id)}),selected_items.push(grade,background,bodyColor,wheel),(selected_items=selected_items.concat(ext_option)).push(interior),lastItemId&&itemId&&(selected_items=function(items,lastItemId,itemId){var checkRegExp=new RegExp("\\b"+itemId+"\\b"),searchStr=items.join(",");checkRegExp.test(searchStr)||(checkRegExp=new RegExp("\\b"+lastItemId+"\\b"));return searchStr=","==(searchStr=searchStr.replace(checkRegExp,"")).charAt(0)?searchStr.replace(",",""):","==searchStr.charAt(searchStr.length-1)?searchStr.replace("/,/$",""):searchStr.replace(",,",","),(items=searchStr.split(",")).unshift(itemId),items}(selected_items,lastItemId,itemId)),configCore.validate(selected_items)}function loadImages(materials){var mode=$(".modeBtn.selected").attr("id");"EXTERIOR"===mode?configView.preloadManager(materials):"INTERIOR"===mode&&function(materials){var materialDirPath=gradeList.materialDirPath;if(isSD){material=materials[0].material,path=materialDirPath+material+"/"+material;$("#INT_BOX_Z1 img").attr("src",path+"_01.jpg"),$("#INT_BOX_Z2 img").attr("src",path+"_04.jpg"),$("#INT_BOX_X1 img").attr("src",path+"_03.jpg"),$("#INT_BOX_X2 img").attr("src",path+"_02.jpg"),$("#INT_BOX_Y1 img").attr("src",path+"_05.jpg"),$("#INT_BOX_Y2 img").attr("src",path+"_06.jpg")}else{var path,material=materials[0].material,imgs=[(path=materialDirPath+material+"/"+material)+"_03.jpg",path+"_02.jpg",path+"_05.jpg",path+"_06.jpg",path+"_04.jpg",path+"_01.jpg"];window.loadThreejs(imgs)}$("#loadingIndicator").stop(!0).show(10).delay(2e3).hide(10)}(materials)}function refreshView(validated_items){$("#indicator ul li").removeClass("loaded");(function(validated_items){for(var i=0;i<validated_items.length;i++){var itemId=validated_items[i];if(itemId){var checkGroup=itemId.split("_")[0],checkRegExp=new RegExp(NOT_SELECTED_ID_STR+"$"),$mainMenu=$("#"+itemId),$subMenu=$('[data-subitemid="'+itemId+'"]');if($mainMenu.size()||$subMenu.size())$mainMenu.hasClass("radioType")||$subMenu.hasClass("radioType")?($("#"+checkGroup).find(".selected").removeClass(selectedClsName),0<$subMenu.size()&&($mainMenu=updateMainManuLabel($mainMenu,$subMenu,itemId)),$mainMenu.addClass(selectedClsName),$subMenu.addClass(selectedClsName)):checkRegExp.test(itemId)?($mainMenu.removeClass(selectedClsName),$subMenu.removeClass(selectedClsName)):(0<$subMenu.size()&&($mainMenu=updateMainManuLabel($mainMenu,$subMenu,itemId)),$mainMenu.addClass(selectedClsName),$subMenu.addClass(selectedClsName));else{var lastItem=$("#"+getToggledItemId(itemId));if(0<lastItem.size()&&!lastItem.hasClass("radioType")){var lastItemId=getToggledItemId(itemId);$mainMenu=$("#"+checkGroup).find("#"+lastItemId),$subMenu=$("#"+checkGroup).find('[data-subitemid="'+lastItemId+'"]'),$mainMenu.toggleClass(selectedClsName),$subMenu.toggleClass(selectedClsName),$mainMenu.attr("id",itemId),$subMenu.attr("data-subitemid",itemId)}}}}})(validated_items.selectItems),function(disabled_items){$("."+selectNoticeClsName).removeClass(selectNoticeClsName);for(var i=0;i<disabled_items.length;i++){var $target=$("#"+disabled_items[i]);if(0===$target.size()){var targetId=getToggledItemId(disabled_items[i]);$target=$("#"+targetId)}else $target.hasClass("selected")&&$target.removeClass(selectedClsName);$target.addClass(selectNoticeClsName)}}(validated_items.disabledItems);var materials=function(validated_select_items){var mode=$(".modeBtn.selected").attr("id");return"EXTERIOR"===mode?configCore.getDisplayMaterials(selectedGradeRelation.EXT,validated_select_items):"INTERIOR"===mode?configCore.getDisplayMaterials(selectedGradeRelation.INT,validated_select_items):void 0}(validated_items.selectItems);materials&&loadImages(materials);var bcLabel=$("#EXT_BODY_COLOR .selected .itemLabel").text(),grdLabel=$("#GRADE_LIST .selected .itemLabel").text();$("#gradeName p.bcLabel").text(bcLabel),$("#gradeName p.grdLabel").text(grdLabel),$("#EXT_BODY_COLOR span.bcLabel").text(bcLabel)}function updateMainManuLabel(mainMenu,subMenu,newId){return 0<mainMenu.size()&&(mainMenu=$(subMenu.closest("dd")[0])),mainMenu.attr("id",newId),mainMenu.find(".itemLabel")[0].innerHTML=subMenu.find(".itemLabel")[0].innerHTML,mainMenu.find(".itemDescription")[0].innerHTML=subMenu.find(".itemDescription")[0].innerHTML,mainMenu}function toggleCheckTypeBtnId(targetObj){var itemId=$(targetObj).attr("id"),newItemId=getToggledItemId(itemId=itemId||$(targetObj).attr("data-subitemid")),checkGroup=itemId.split("_")[0];0===$("#"+checkGroup+" #"+itemId).attr("id",newItemId).size()&&$("#"+checkGroup+" dd."+checkGroup).attr("id",newItemId),$("#"+checkGroup).find('[data-subitemid="'+itemId+'"]').attr("data-subitemid",newItemId)}function getToggledItemId(itemId){var re=new RegExp(NOT_SELECTED_ID_STR+"$");return re.test(itemId)?itemId.replace(re,""):itemId+NOT_SELECTED_ID_STR}function addSummaryItem(target,titleLabel,lists,showDescription){$("<dt>").text(titleLabel).appendTo(target);for(var $items=$(lists).find("."+selectedClsName).not(".subMenu ."+selectedClsName),i=0;i<$items.length;i++)if("none"!=$items.eq(i).css("display")){var html='<dd><span class="itemLabel">'+$items.eq(i).find(".itemLabel").html()+'</span><span class="itemDescription" style="display:'+(showDescription?"block":"none")+'">'+$items.eq(i).find(".itemDescription").html()+"</span></dd>";$(html).appendTo(target)}}function setSlideArea(target,flagBodyColor){var areaW=$("#selectMenu .selectMenuWrapper").width(),itemW=$(".slideAreaWrap dl dd",target).outerWidth(!0),pageItemLength=Math.floor(areaW/itemW),slideSpanW=pageItemLength*itemW,itemLength=$(".slideAreaWrap dl dd",target).filter(function(){return"none"!=$(this).css("display")}).length;if(flagBodyColor){var twotoneItemLength=$(target+' .slideAreaWrap dl dd[id$="_R"]').length,monotoneItemLength=itemLength-twotoneItemLength;itemLength=twotoneItemLength<monotoneItemLength?monotoneItemLength:twotoneItemLength}var pageLength=Math.floor((itemLength-1)/pageItemLength),currentPage=0,$slideAreaWrap=$(".slideAreaWrap",target);$slideAreaWrap.css("margin-left","0px");var $pageIndicator=$(".slideNavi .pageIndicator",target);$pageIndicator.empty();for(var i=0;i<=pageLength;i++)$("<li>").appendTo($pageIndicator);$(".slideNavi .pageIndicator li",target).eq(0).addClass("on"),pageLength<1?$(".slideNavi",target).hide():$(".slideNavi",target).show(),$(".slideNavi .slideL",target).off("click"),$(".slideNavi .slideL",target).on("click",function(){--currentPage<0&&(currentPage=0),$slideAreaWrap.stop(!0).animate({marginLeft:currentPage*-slideSpanW+"px"},500),$(".slideNavi .pageIndicator li",target).removeClass("on"),$(".slideNavi .pageIndicator li",target).eq(currentPage).addClass("on")}),$(".slideNavi .slideR",target).off("click"),$(".slideNavi .slideR",target).on("click",function(){pageLength<++currentPage&&(currentPage=pageLength),$slideAreaWrap.stop(!0).animate({marginLeft:currentPage*-slideSpanW+"px"},500),$(".slideNavi .pageIndicator li",target).removeClass("on"),$(".slideNavi .pageIndicator li",target).eq(currentPage).addClass("on")})}$(function(){configCore=new ConfigCore,$(configCore).bind("loadComplete",gradeListLoadHandler),$(configCore).bind("loadFailed",function(){}),configCore.loadSetting("../assets/setting/grade_list.json")})}();